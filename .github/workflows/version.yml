name: Planner
on: 
  workflow_dispatch:
    inputs:
      force_rebuild:
        description:  'Force Rebuild'
        required:     false
        default:      false
        type:         boolean

  push:   
    branches: [ "master" ]
    paths:
      - '**/cmake-**.yml'
      - '**/cmake/**.json'

  schedule:
    - cron:  '0 0 * * 0' # “At 00:00 on every Sunday”

jobs:

  params:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
    
    steps:
      - name: Checkout Codebase
        uses: actions/checkout@v3
        
      - name: Custom JSON reader Action
        id: inputs
        uses: kiran-godse/Nodejs-Rainfall@main
        with:
          json-file: ./recipe/cmake/cmake.recipe
          schema-file: ./.schema/recipe.json
        
      - name: outputs
        id: set_output
        run: |
               json_content=$(echo '${{ steps.inputs.outputs.json }}' | jq -c .) 
               substrate_tag=$(echo "$json_content" | jq .substrate.tag)
               substrate_name=$(echo "$json_content" | jq .substrate.name)
               substrate_registry=$(echo "$json_content" | jq .substrate.registry)
               substrate_auth=$(echo "$json_content" | jq .substrate.needs_auth)  
               echo "substrate_tag=$substrate_tag" >> $GITHUB_OUTPUT
               echo "substrate_name=$substrate_name" >> $GITHUB_OUTPUT
               echo "substrate_registry=$substrate_registry" >> $GITHUB_OUTPUT
               echo "substrate_auth=$substrate_auth" >> $GITHUB_OUTPUT
#       - name: Find devcontainer base image version
#         run: |
#           devcontainer_file="path/to/your/devcontainer.json"  # Update with the actual path to your devcontainer.json file
#           base_image=$(jq -r '.build.args.BASE_IMAGE' "$devcontainer_file")
#           base_image_version=$(docker pull "$base_image" --quiet | awk -F':' '{print $2}')
#           echo "Base Image: $base_image"
#           echo "Version: $base_image_version"         
      - name: Test outputs
        id:   test
        run: |
  
               echo "${{ steps.set_output.outputs.substrate_tag }}"
               echo "${{ steps.set_output.outputs.substrate_name }}"
               echo "${{ steps.set_output.outputs.substrate_registry }}"
               echo "${{ steps.set_output.outputs.substrate_auth }}"
   
